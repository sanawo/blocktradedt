# 高级功能部署总结

## ✅ 已完成的功能

### 1. 自然语言复杂查询

✅ **功能**：支持"2025年Kruger收购对漂白针叶木浆价格的影响"等复杂查询
✅ **文件**：`app/complex_query_parser.py`
✅ **特点**：
- 自动识别实体（公司、产品、地区）
- 自动识别事件类型（收购、涨价、停产等）
- 提取时间信息（年份、月份）
- 识别关系类型（影响、导致、关联）
- 生成知识图谱查询和关联路径

### 2. 研报摘要生成

✅ **功能**：上传5000字以内行业研报，8秒内输出结构化摘要
✅ **文件**：`app/report_summarizer.py`
✅ **输出内容**：
- 标题
- 核心观点（前5条）
- 数据支撑（百分比、数量、价格等）
- 趋势判断
- 关键发现
- 风险分析
- 投资建议
- 置信度评分

### 3. 知识图谱可视化

✅ **后端**：`app/kg_visualizer.py`
✅ **前端**：`static/kg_visualizer.js`
✅ **功能**：
- 查询结果可视化展示
- 关联实体和关系链路
- 点击节点查看详细属性
- 交互式可视化（拖拽、缩放）
- 支持导出PNG和JSON

## 📦 新增文件

```
app/
├── complex_query_parser.py      # 复杂查询解析器
├── report_summarizer.py         # 研报摘要生成器
├── kg_visualizer.py             # KG可视化器（后端）
└── advanced_features.py         # 高级功能整合模块

static/
└── kg_visualizer.js             # KG可视化组件（前端）

ADVANCED_FEATURES_GUIDE.md       # 使用文档
```

## 🔗 API端点

### 复杂查询
```
POST /api/complex/query
Body: {"query": "2025年Kruger收购对漂白针叶木浆价格的影响", "top_k": 10}
```

### 研报摘要
```
POST /api/report/summarize
Body: {"report_text": "研报内容..."}
或
POST /api/report/summarize (multipart/form-data)
File: report.txt
```

### 知识图谱可视化
```
POST /api/kg/visualize
Body: ["针叶木浆", "晨鸣纸业"]
```

### 实体详情
```
GET /api/kg/entity/{entity_id}/detail
```

### 查找路径
```
POST /api/kg/path
Body: {"from_entity": "晨鸣纸业", "to_entity": "桉木"}
```

## 🚀 部署步骤

### 1. 推送到GitHub

```bash
git push origin master
```

### 2. 在Zeabur上部署

访问：https://dash.zeabur.com

1. 找到项目
2. 点击 "Redeploy"
3. 等待部署完成

### 3. 验证功能

```bash
# 测试复杂查询
curl -X POST "https://www.blocktradedt.xyz/api/complex/query" \
  -H "Content-Type: application/json" \
  -d '{"query": "针叶木浆价格趋势", "top_k": 5}'

# 测试研报摘要
curl -X POST "https://www.blocktradedt.xyz/api/report/summarize" \
  -H "Content-Type: application/json" \
  -d '{"report_text": "研报内容..."}'

# 测试KG可视化
curl -X POST "https://www.blocktradedt.xyz/api/kg/visualize" \
  -H "Content-Type: application/json" \
  -d '["针叶木浆", "晨鸣纸业"]'
```

## 📊 技术规格

### 性能指标

- **复杂查询**：<500ms
- **研报摘要**：8秒内处理5000字
- **KG可视化**：<1秒渲染
- **路径查找**：<100ms

### 依赖

所有功能使用纯Python实现，无需额外大型ML库。

### 浏览器支持

- Chrome（推荐）
- Firefox
- Edge
- Safari

## 📝 使用示例

### Python示例

```python
import requests

# 复杂查询
response = requests.post(
    'https://www.blocktradedt.xyz/api/complex/query',
    json={'query': '2025年Kruger收购对漂白针叶木浆价格的影响', 'top_k': 10}
)
print(response.json())

# 研报摘要
response = requests.post(
    'https://www.blocktradedt.xyz/api/report/summarize',
    json={'report_text': '研报内容...'}
)
print(response.json())

# KG可视化
response = requests.post(
    'https://www.blocktradedt.xyz/api/kg/visualize',
    json=['针叶木浆', '晨鸣纸业']
)
print(response.json())
```

### JavaScript示例

```javascript
// 初始化KG可视化器
const visualizer = new KnowledgeGraphVisualizer('kg-container');
await visualizer.initialize();

// 加载数据
await visualizer.loadData(['针叶木浆', '晨鸣纸业']);

// 导出图片
visualizer.exportImage();
```

## 🎯 功能特点

### 复杂查询
- ✅ 自动实体识别
- ✅ 事件类型识别
- ✅ 时间信息提取
- ✅ 关系识别
- ✅ 知识图谱路径查找

### 研报摘要
- ✅ 结构化输出
- ✅ 多维度分析
- ✅ 高质量摘要
- ✅ 快速处理（8秒）

### KG可视化
- ✅ 交互式展示
- ✅ 点击查看详情
- ✅ 自动布局
- ✅ 支持导出

## 📖 详细文档

查看 `ADVANCED_FEATURES_GUIDE.md` 获取：
- 完整API文档
- 使用示例
- 技术实现细节
- 故障排除指南

## ⚠️ 注意事项

1. **文件大小限制**：研报摘要限制5000字
2. **处理时间**：复杂查询可能需要几秒
3. **浏览器兼容性**：建议使用现代浏览器
4. **知识图谱**：实体数量影响可视化性能

## 🔄 更新历史

- **Commit 64cae6a**: Add advanced features: complex query, report summarization, and KG visualization
- **Commit 2e10963**: Add advanced features guide

## 📞 支持

如有问题：
- 查看 `ADVANCED_FEATURES_GUIDE.md`
- 查看API文档
- 提交Issue

