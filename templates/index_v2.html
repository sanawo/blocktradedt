<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Block Trade DT - å¤§å®—äº¤æ˜“æ•°æ®å¹³å°</title>
  
  <!-- CSS -->
  <link rel="stylesheet" href="/static/styles_v2.css" />
  
  <!-- å¤–éƒ¨åº“ -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
  
  <!-- æ‡’åŠ è½½ -->
  <script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.8.5/dist/lazyload.min.js"></script>
</head>
<body>
  <!-- è‡ªå®šä¹‰å…‰æ ‡ -->
  <div class="custom-cursor">
    <div class="cursor-dot"></div>
    <div class="cursor-outline"></div>
  </div>

  <!-- å›ºå®šå¯¼èˆªæ  -->
  <header class="fixed-header" id="mainHeader">
    <div class="header-container">
      <div class="logo">
        <span class="logo-icon">ğŸ“Š</span>
        <span class="logo-text">Block Trade DT</span>
      </div>
      
      <nav class="main-nav">
        <a href="#hero" class="nav-link active" data-section="hero">é¦–é¡µ</a>
        <a href="#data" class="nav-link" data-section="data">å¸‚åœºæ•°æ®</a>
        <a href="#analysis" class="nav-link" data-section="analysis">æ™ºèƒ½åˆ†æ</a>
        <a href="#news" class="nav-link" data-section="news">å®æ—¶èµ„è®¯</a>
        <a href="/trends" class="nav-link">è¶‹åŠ¿å›¾è¡¨</a>
      </nav>
      
      <div class="header-actions">
        <a href="/news" class="news-badge">
          <span class="badge-icon">ğŸ“°</span>
          <span class="badge-text">å®æ—¶æ–°é—»</span>
          <span class="badge-indicator"></span>
        </a>
        <div class="user-profile" id="userProfile">
          <div class="user-avatar">ğŸ‘¤</div>
          <span class="username">ç”¨æˆ·</span>
        </div>
      </div>
    </div>
  </header>

  <!-- æ»‘åŠ¨å¯¼èˆªæŒ‡ç¤ºå™¨ -->
  <div class="scroll-indicator">
    <div class="indicator-item active" data-target="hero"></div>
    <div class="indicator-item" data-target="data"></div>
    <div class="indicator-item" data-target="analysis"></div>
    <div class="indicator-item" data-target="news"></div>
  </div>

  <!-- ä¸»è¦å†…å®¹åŒºåŸŸ - å…¨å±æ»‘åŠ¨åˆ†å± -->
  <main class="fullpage-container">
    
    <!-- ç¬¬ä¸€å±ï¼šè‹±é›„åŒº -->
    <section class="section hero-section" id="hero" data-anchor="hero">
      <div class="hero-background">
        <img 
          class="lazy hero-bg-image" 
          data-src="https://images.unsplash.com/photo-1611974789855-9c2a0a7236a3?w=1920&q=80" 
          alt="äº¤æ˜“å¤§å…èƒŒæ™¯"
        />
        <div class="hero-overlay"></div>
      </div>
      
      <div class="hero-content">
        <div class="hero-badge animate-fade-in">
          <span class="badge-dot"></span>
          <span>å®æ—¶æ›´æ–°ä¸­</span>
        </div>
        
        <h1 class="hero-title animate-slide-up">
          AIé©±åŠ¨çš„<br/>
          <span class="gradient-text">å¤§å®—äº¤æ˜“æ•°æ®å¹³å°</span>
        </h1>
        
        <p class="hero-subtitle animate-slide-up delay-1">
          åŸºäºæ™ºè°±AIæŠ€æœ¯ï¼Œå®æ—¶åˆ†æå¸‚åœºè¶‹åŠ¿ï¼Œç²¾å‡†é¢„æµ‹äº¤æ˜“æœºä¼š
        </p>
        
        <div class="hero-stats animate-slide-up delay-2">
          <div class="stat-item">
            <div class="stat-value" data-value="15000">0</div>
            <div class="stat-label">æ—¥äº¤æ˜“é‡</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" data-value="4568">0</div>
            <div class="stat-label">æ´»è·ƒè‚¡ç¥¨</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" data-value="98">0</div>
            <div class="stat-label">å‡†ç¡®ç‡%</div>
          </div>
        </div>
        
        <div class="hero-actions animate-slide-up delay-3">
          <button class="btn btn-primary btn-large" onclick="scrollToSection('data')">
            <span>å¼€å§‹æ¢ç´¢</span>
            <span class="btn-arrow">â†’</span>
          </button>
          <button class="btn btn-outline btn-large" onclick="scrollToSection('analysis')">
            <span>AIæ™ºèƒ½åˆ†æ</span>
          </button>
        </div>
      </div>
      
      <div class="scroll-hint">
        <div class="mouse-icon">
          <div class="mouse-wheel"></div>
        </div>
        <span>å‘ä¸‹æ»šåŠ¨æ¢ç´¢æ›´å¤š</span>
      </div>
    </section>

    <!-- ç¬¬äºŒå±ï¼šå¸‚åœºæ•°æ® -->
    <section class="section data-section" id="data" data-anchor="data">
      <div class="section-background">
        <img 
          class="lazy section-bg-image" 
          data-src="https://images.unsplash.com/photo-1642790106117-e829e14a795f?w=1920&q=80" 
          alt="æ•°æ®èƒŒæ™¯"
        />
        <div class="section-overlay"></div>
      </div>
      
      <div class="section-container">
        <div class="section-header">
          <h2 class="section-title reveal-text">å®æ—¶å¸‚åœºæ•°æ®</h2>
          <p class="section-subtitle">æƒå¨æ•°æ®æºçš„å®æ—¶å¤§å®—äº¤æ˜“æ•°æ®</p>
        </div>
        
        <div class="data-grid">
          <!-- å¸‚åœºæ¦‚è§ˆå¡ç‰‡ -->
          <div class="data-card card-hover" data-tilt>
            <div class="card-icon">ğŸ“ˆ</div>
            <h3>ä¸Šè¯æŒ‡æ•°</h3>
            <div class="card-value">
              <span class="value-number" id="indexValue">3,666.44</span>
              <span class="value-change negative" id="indexChange">-0.46%</span>
            </div>
            <div class="card-chart">
              <canvas id="miniChart1" width="100" height="40"></canvas>
            </div>
          </div>
          
          <!-- äº¤æ˜“é‡å¡ç‰‡ -->
          <div class="data-card card-hover" data-tilt>
            <div class="card-icon">ğŸ’°</div>
            <h3>æ€»æˆäº¤é¢</h3>
            <div class="card-value">
              <span class="value-number">4567.89<small>äº¿</small></span>
              <span class="value-change positive">+12.5%</span>
            </div>
            <div class="card-progress">
              <div class="progress-bar" style="width: 75%"></div>
            </div>
          </div>
          
          <!-- æ´»è·ƒè‚¡ç¥¨ -->
          <div class="data-card card-hover" data-tilt>
            <div class="card-icon">ğŸ¢</div>
            <h3>æ´»è·ƒè‚¡ç¥¨</h3>
            <div class="card-value">
              <span class="value-number">2,847<small>åª</small></span>
              <span class="value-change positive">+15</span>
            </div>
            <div class="card-tags">
              <span class="tag">é’¢æ</span>
              <span class="tag">ç…¤ç‚­</span>
              <span class="tag">æœ‰è‰²</span>
            </div>
          </div>
          
          <!-- æ™ºèƒ½æ¨è -->
          <div class="data-card card-hover card-highlight" data-tilt>
            <div class="card-icon">ğŸ¤–</div>
            <h3>AIæ™ºèƒ½æ¨è</h3>
            <div class="ai-insight">
              <p>åŸºäºå¤§æ•°æ®åˆ†æï¼Œä»Šæ—¥é’¢æç±»äº¤æ˜“æ´»è·ƒåº¦æå‡32%ï¼Œå»ºè®®é‡ç‚¹å…³æ³¨...</p>
            </div>
            <button class="btn btn-sm btn-primary" onclick="scrollToSection('analysis')">
              æŸ¥çœ‹è¯¦æƒ…
            </button>
          </div>
        </div>
        
        <!-- å®æ—¶æ•°æ®è¡¨æ ¼ -->
        <div class="data-table-container">
          <h3 class="table-title">çƒ­é—¨äº¤æ˜“æ’è¡Œ</h3>
          <div class="data-table">
            <table>
              <thead>
                <tr>
                  <th>æ’å</th>
                  <th>è¯åˆ¸ä»£ç </th>
                  <th>è¯åˆ¸ç®€ç§°</th>
                  <th>æœ€æ–°ä»·</th>
                  <th>æ¶¨è·Œå¹…</th>
                  <th>æˆäº¤é¢(ä¸‡)</th>
                </tr>
              </thead>
              <tbody id="hotStocksTable">
                <!-- åŠ¨æ€å¡«å…… -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- ç¬¬ä¸‰å±ï¼šæ™ºèƒ½åˆ†æ -->
    <section class="section analysis-section" id="analysis" data-anchor="analysis">
      <div class="section-background">
        <img 
          class="lazy section-bg-image" 
          data-src="https://images.unsplash.com/photo-1551288049-bebda4e38f71?w=1920&q=80" 
          alt="åˆ†æèƒŒæ™¯"
        />
        <div class="section-overlay"></div>
      </div>
      
      <div class="section-container">
        <div class="section-header">
          <h2 class="section-title reveal-text">AIæ™ºèƒ½åˆ†æ</h2>
          <p class="section-subtitle">åŸºäºæ™ºè°±AIçš„ä¸“ä¸šé‡‘èåˆ†æ</p>
        </div>
        
        <div class="analysis-layout">
          <!-- æœç´¢åŒºåŸŸ -->
          <div class="search-panel card-glow">
            <h3>æ™ºèƒ½æ£€ç´¢</h3>
            <div class="search-bar">
              <input 
                type="text" 
                id="query" 
                placeholder="ä¾‹å¦‚ï¼šæŸ¥æ‰¾2024å¹´å¤§å®—äº¤æ˜“æ•°æ®ï¼Œåˆ†æé“œç›¸å…³äº¤æ˜“" 
                class="search-input"
              />
              <button class="btn btn-primary" id="search-btn">
                <span>ğŸš€</span>
                <span>å¼€å§‹æ£€ç´¢</span>
              </button>
            </div>
            
            <div class="search-options">
              <label class="option-item">
                <span>æ£€ç´¢æ•°é‡</span>
                <input type="number" id="topk" value="10" min="1" max="50" />
              </label>
              <label class="option-item">
                <input type="checkbox" id="use_llm" checked />
                <span>ä½¿ç”¨AIåˆ†æ</span>
              </label>
            </div>
            
            <div class="search-suggestions">
              <span class="suggestion-chip" data-query="åˆ†æ2024å¹´å¤§å®—äº¤æ˜“è¶‹åŠ¿">2024è¶‹åŠ¿åˆ†æ</span>
              <span class="suggestion-chip" data-query="æŸ¥æ‰¾è‚¡ç¥¨å¤§å®—äº¤æ˜“æ•°æ®">è‚¡ç¥¨äº¤æ˜“</span>
              <span class="suggestion-chip" data-query="åŸºé‡‘å¤§å®—äº¤æ˜“åˆ†æ">åŸºé‡‘åˆ†æ</span>
            </div>
          </div>
          
          <!-- AIåŠ©æ‰‹ -->
          <div class="ai-assistant card-glow">
            <div class="assistant-header">
              <h3>ğŸ¤– AIæ™ºèƒ½åŠ©æ‰‹</h3>
              <button class="btn btn-sm" onclick="clearChat()">æ¸…ç©º</button>
            </div>
            
            <div class="chat-messages" id="chatMessages">
              <div class="message assistant">
                <div class="message-avatar">ğŸ¤–</div>
                <div class="message-content">
                  <p>æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„ä¸“ä¸šé‡‘èåˆ†æåŠ©æ‰‹ã€‚æˆ‘å¯ä»¥å¸®æ‚¨ï¼š</p>
                  <ul>
                    <li>åˆ†æå¤§å®—äº¤æ˜“å¸‚åœºæ•°æ®</li>
                    <li>è§£è¯»Kçº¿å›¾å’Œè¶‹åŠ¿</li>
                    <li>æä¾›æŠ•èµ„å»ºè®®å’Œé£é™©è¯„ä¼°</li>
                  </ul>
                </div>
              </div>
            </div>
            
            <div class="chat-input-container">
              <input 
                type="text" 
                id="aiMessageInput" 
                placeholder="è¾“å…¥æ‚¨çš„é—®é¢˜..." 
                class="chat-input"
              />
              <button class="btn btn-primary" onclick="handleAIChat()">
                å‘é€
              </button>
            </div>
          </div>
        </div>
        
        <!-- æœç´¢ç»“æœ -->
        <div class="search-results" id="resultsSection" style="display: none;">
          <div class="results-header">
            <h3 id="result-count">æœç´¢ç»“æœ</h3>
            <span class="search-time">è€—æ—¶: <span id="searchTime">0s</span></span>
          </div>
          <div id="summary" class="ai-summary"></div>
          <div id="results" class="results-grid"></div>
        </div>
      </div>
    </section>

    <!-- ç¬¬å››å±ï¼šå®æ—¶èµ„è®¯ -->
    <section class="section news-section" id="news" data-anchor="news">
      <div class="section-background">
        <img 
          class="lazy section-bg-image" 
          data-src="https://images.unsplash.com/photo-1504711434969-e33886168f5c?w=1920&q=80" 
          alt="æ–°é—»èƒŒæ™¯"
        />
        <div class="section-overlay"></div>
      </div>
      
      <div class="section-container">
        <div class="section-header">
          <h2 class="section-title reveal-text">å®æ—¶èµ„è®¯</h2>
          <p class="section-subtitle">æœ€æ–°çš„å¤§å®—äº¤æ˜“å¸‚åœºåŠ¨æ€</p>
          <a href="/news" class="btn btn-outline">æŸ¥çœ‹å…¨éƒ¨æ–°é—» â†’</a>
        </div>
        
        <div class="news-grid" id="newsGrid">
          <!-- åŠ¨æ€åŠ è½½æ–°é—» -->
        </div>
        
        <!-- å¸‚åœºçƒ­ç‚¹ -->
        <div class="hotspot-section">
          <h3>ğŸ“Š ä»Šæ—¥å¸‚åœºçƒ­ç‚¹</h3>
          <div class="hotspot-tags">
            <span class="hotspot-tag hot">é’¢æä»·æ ¼ä¸Šæ¶¨</span>
            <span class="hotspot-tag">ç…¤ç‚­ä¾›åº”ç´§å¼ </span>
            <span class="hotspot-tag trending">æœ‰è‰²é‡‘å±åå¼¹</span>
            <span class="hotspot-tag">åŸæ²¹æœŸè´§æ³¢åŠ¨</span>
            <span class="hotspot-tag">åŒ–å·¥äº§å“è°ƒæ•´</span>
          </div>
        </div>
      </div>
    </section>

  </main>

  <!-- åŠ è½½åŠ¨ç”» -->
  <div class="loading-overlay" id="loadingOverlay" style="display: none;">
    <div class="loading-spinner"></div>
    <div class="loading-text">AIæ­£åœ¨åˆ†æä¸­...</div>
  </div>

  <!-- é¡µè„š -->
  <footer class="modern-footer">
    <div class="footer-content">
      <div class="footer-brand">
        <h3>Block Trade DT</h3>
        <p>ä¸“ä¸šçš„å¤§å®—äº¤æ˜“æ•°æ®å¹³å°</p>
      </div>
      <div class="footer-links">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAkBUw0RHPp3VqepZHs6YB8nzjlQygC3Lr4ZuRLkgvabE" target="_blank">æŠ–éŸ³</a>
        <a href="https://weibo.com/u/6136590501" target="_blank">å¾®åš</a>
      </div>
    </div>
  </footer>

  <!-- ç™»å½•/æ³¨å†Œæ¨¡æ€æ¡† -->
  <div class="auth-modal" id="authModal" style="display: none;">
    <div class="modal-overlay" onclick="closeAuthModal()"></div>
    <div class="modal-container">
      <button class="modal-close" onclick="closeAuthModal()">âœ•</button>
      
      <!-- ç™»å½•è¡¨å• -->
      <div class="auth-form" id="loginForm">
        <h2 class="modal-title">ç™»å½•è´¦æˆ·</h2>
        <p class="modal-subtitle">æ¬¢è¿å›æ¥ï¼è¯·ç™»å½•æ‚¨çš„è´¦æˆ·</p>
        
        <form onsubmit="handleLogin(event)">
          <div class="form-group">
            <label for="loginUsername">ç”¨æˆ·å</label>
            <input type="text" id="loginUsername" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" required />
          </div>
          
          <div class="form-group">
            <label for="loginPassword">å¯†ç </label>
            <input type="password" id="loginPassword" placeholder="è¯·è¾“å…¥å¯†ç " required />
          </div>
          
          <button type="submit" class="btn btn-primary btn-block">ç™»å½•</button>
        </form>
        
        <div class="form-footer">
          <p>è¿˜æ²¡æœ‰è´¦æˆ·ï¼Ÿ <a href="#" onclick="switchToRegister(); return false;">ç«‹å³æ³¨å†Œ</a></p>
        </div>
      </div>
      
      <!-- æ³¨å†Œè¡¨å• -->
      <div class="auth-form" id="registerForm" style="display: none;">
        <h2 class="modal-title">åˆ›å»ºè´¦æˆ·</h2>
        <p class="modal-subtitle">åŠ å…¥æˆ‘ä»¬ï¼Œå¼€å¯æ™ºèƒ½äº¤æ˜“ä¹‹æ—…</p>
        
        <form onsubmit="handleRegister(event)">
          <div class="form-group">
            <label for="registerUsername">ç”¨æˆ·å</label>
            <input type="text" id="registerUsername" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" required minlength="3" />
          </div>
          
          <div class="form-group">
            <label for="registerEmail">é‚®ç®±</label>
            <input type="email" id="registerEmail" placeholder="è¯·è¾“å…¥é‚®ç®±åœ°å€" required />
          </div>
          
          <div class="form-group">
            <label for="registerFullName">å§“å</label>
            <input type="text" id="registerFullName" placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å" required />
          </div>
          
          <div class="form-group">
            <label for="registerPassword">å¯†ç </label>
            <input type="password" id="registerPassword" placeholder="è¯·è¾“å…¥å¯†ç " required minlength="6" />
          </div>
          
          <div class="form-group">
            <label for="registerConfirmPassword">ç¡®è®¤å¯†ç </label>
            <input type="password" id="registerConfirmPassword" placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç " required minlength="6" />
          </div>
          
          <button type="submit" class="btn btn-primary btn-block">æ³¨å†Œ</button>
        </form>
        
        <div class="form-footer">
          <p>å·²æœ‰è´¦æˆ·ï¼Ÿ <a href="#" onclick="switchToLogin(); return false;">ç«‹å³ç™»å½•</a></p>
        </div>
      </div>
    </div>
  </div>

  <style>
    /* æ¨¡æ€æ¡†æ ·å¼ */
    .auth-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 10000;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .modal-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
    }
    
    .modal-container {
      position: relative;
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-xl);
      padding: 2.5rem;
      max-width: 480px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: var(--shadow-2xl);
      animation: modalSlideIn 0.3s ease-out;
    }
    
    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .modal-close {
      position: absolute;
      top: 1.5rem;
      right: 1.5rem;
      background: transparent;
      border: none;
      font-size: 1.5rem;
      color: var(--text-muted);
      cursor: pointer;
      transition: all var(--transition-base);
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-md);
    }
    
    .modal-close:hover {
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-primary);
    }
    
    .modal-title {
      font-size: 1.75rem;
      margin-bottom: 0.5rem;
      background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .modal-subtitle {
      color: var(--text-secondary);
      margin-bottom: 2rem;
    }
    
    .form-group {
      margin-bottom: 1.5rem;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--text-primary);
    }
    
    .form-group input {
      width: 100%;
      padding: 0.75rem 1rem;
      background: var(--bg-primary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      color: var(--text-primary);
      font-size: 1rem;
      transition: all var(--transition-base);
    }
    
    .form-group input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    
    .btn-block {
      width: 100%;
      margin-top: 1rem;
    }
    
    .form-footer {
      margin-top: 1.5rem;
      text-align: center;
      color: var(--text-secondary);
    }
    
    .form-footer a {
      color: var(--primary-color);
      text-decoration: none;
      font-weight: 500;
      transition: all var(--transition-base);
    }
    
    .form-footer a:hover {
      color: var(--accent-color);
    }
  </style>

  <script>
    // è®¤è¯ç›¸å…³å‡½æ•°
    let authToken = localStorage.getItem('authToken');
    let currentUser = null;
    
    // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ç™»å½•çŠ¶æ€
    window.addEventListener('DOMContentLoaded', () => {
      if (authToken) {
        fetchUserProfile();
      }
      
      // ç»™ç”¨æˆ·å¤´åƒæ·»åŠ ç‚¹å‡»äº‹ä»¶
      const userProfile = document.getElementById('userProfile');
      if (userProfile) {
        userProfile.addEventListener('click', () => {
          if (!authToken) {
            openAuthModal('login');
          }
        });
      }
    });
    
    // æ‰“å¼€è®¤è¯æ¨¡æ€æ¡†
    function openAuthModal(type = 'login') {
      document.getElementById('authModal').style.display = 'flex';
      if (type === 'login') {
        switchToLogin();
      } else {
        switchToRegister();
      }
    }
    
    // å…³é—­è®¤è¯æ¨¡æ€æ¡†
    function closeAuthModal() {
      document.getElementById('authModal').style.display = 'none';
    }
    
    // åˆ‡æ¢åˆ°ç™»å½•è¡¨å•
    function switchToLogin() {
      document.getElementById('loginForm').style.display = 'block';
      document.getElementById('registerForm').style.display = 'none';
    }
    
    // åˆ‡æ¢åˆ°æ³¨å†Œè¡¨å•
    function switchToRegister() {
      document.getElementById('loginForm').style.display = 'none';
      document.getElementById('registerForm').style.display = 'block';
    }
    
    // å¤„ç†ç™»å½•
    async function handleLogin(event) {
      event.preventDefault();
      
      const username = document.getElementById('loginUsername').value;
      const password = document.getElementById('loginPassword').value;
      
      try {
        const response = await fetch('/api/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, password })
        });
        
        const data = await response.json();
        
        if (response.ok) {
          authToken = data.access_token;
          localStorage.setItem('authToken', authToken);
          currentUser = data.user;
          updateUserProfile();
          closeAuthModal();
          showNotification('ç™»å½•æˆåŠŸï¼', 'success');
        } else {
          showNotification(data.detail || 'ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç”¨æˆ·åå’Œå¯†ç ', 'error');
        }
      } catch (error) {
        console.error('ç™»å½•é”™è¯¯:', error);
        showNotification('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•', 'error');
      }
    }
    
    // å¤„ç†æ³¨å†Œ
    async function handleRegister(event) {
      event.preventDefault();
      
      const username = document.getElementById('registerUsername').value;
      const email = document.getElementById('registerEmail').value;
      const fullName = document.getElementById('registerFullName').value;
      const password = document.getElementById('registerPassword').value;
      const confirmPassword = document.getElementById('registerConfirmPassword').value;
      
      if (password !== confirmPassword) {
        showNotification('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´', 'error');
        return;
      }
      
      try {
        const response = await fetch('/api/register', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            username,
            email,
            full_name: fullName,
            password
          })
        });
        
        const data = await response.json();
        
        if (response.ok) {
          showNotification('æ³¨å†ŒæˆåŠŸï¼è¯·ç™»å½•', 'success');
          switchToLogin();
          document.getElementById('loginUsername').value = username;
        } else {
          showNotification(data.detail || 'æ³¨å†Œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
        }
      } catch (error) {
        console.error('æ³¨å†Œé”™è¯¯:', error);
        showNotification('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•', 'error');
      }
    }
    
    // è·å–ç”¨æˆ·ä¿¡æ¯
    async function fetchUserProfile() {
      try {
        const response = await fetch('/api/user/profile', {
          headers: {
            'Authorization': `Bearer ${authToken}`
          }
        });
        
        if (response.ok) {
          currentUser = await response.json();
          updateUserProfile();
        } else {
          // Tokenæ— æ•ˆï¼Œæ¸…é™¤ç™»å½•çŠ¶æ€
          localStorage.removeItem('authToken');
          authToken = null;
        }
      } catch (error) {
        console.error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
      }
    }
    
    // æ›´æ–°ç”¨æˆ·æ˜¾ç¤º
    function updateUserProfile() {
      const usernameElement = document.querySelector('.username');
      if (usernameElement && currentUser) {
        usernameElement.textContent = currentUser.username || currentUser.full_name || 'ç”¨æˆ·';
      }
    }
    
    // æ˜¾ç¤ºé€šçŸ¥
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `notification notification-${type}`;
      notification.textContent = message;
      notification.style.cssText = `
        position: fixed;
        top: 100px;
        right: 2rem;
        background: ${type === 'success' ? 'var(--success-color)' : type === 'error' ? 'var(--error-color)' : 'var(--primary-color)'};
        color: white;
        padding: 1rem 1.5rem;
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-xl);
        z-index: 10001;
        animation: slideInRight 0.3s ease-out;
      `;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.animation = 'slideOutRight 0.3s ease-out';
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }
  </script>

  <!-- JavaScript -->
  <script src="/static/scripts_v2.js"></script>
</body>
</html>

